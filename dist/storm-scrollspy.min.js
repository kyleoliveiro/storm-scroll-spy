!function(t,e){"object"==typeof exports?module.exports=e():t.StormScrollSpy=e()}(this,function(){"use strict";function t(t,e){var i=[].slice.call(document.querySelectorAll(t+" a"));if(0===i.length)throw new Error("Scrollspy cannot be initialised, no augmentable elements found");return Object.assign(Object.create(a),{DOMElements:i,settings:Object.assign({},r,e)}).init()}function e(){i.forEach(function(t){t.destroy()}),instance=[]}var i=[],n=null,s=function(t){return null===t.offsetParent},o=function(t){if(s(t))return!1;var e={l:0,t:0,b:window.innerHeight||document.documentElement.clientHeight,r:window.innerWidth||document.documentElement.clientWidth},i=t.getBoundingClientRect();return i.right>=e.l&&i.bottom>=e.t&&i.left<=e.r&&i.top<=e.b},r={offset:0,activeClassName:"active",callback:null},a={init:function(){return this.navItems=this.getNavItems(),this.setPositions(),this.sortNavItems(),this.setInitialActiveItem(),this.setCurrentItem(),this.initListeners(),this},initListeners:function(){this.throttledScroll=STORM.UTILS.throttle(function(){this.setCurrentItem()}.bind(this),16),this.throttledResize=STORM.UTILS.throttle(function(){this.setPositions(),this.setCurrentItem()}.bind(this),16),window.addEventListener("scroll",this.throttledScroll,!1),window.addEventListener("scroll",this.throttledResize,!1)},getNavItems:function(){return this.DOMElements.map(function(t){if(t.hash&&document.querySelector(t.hash))return{node:t,target:document.querySelector(t.hash),parent:"li"===t.parentNode.tagName.toLowerCase()?t.parentNode:null,position:0}})},setPositions:function(){var t=function(t){var e=0;if(t.offsetParent){do e+=t.offsetTop,t=t.offsetParent;while(t)}else e=t.offsetTop;return e-=this.settings.offset,e>=0?e:0}.bind(this);n=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight),this.navItems.forEach(function(e){e.position=t(e.target)})},sortNavItems:function(){this.navItems.sort(function(t,e){return t.position>e.position?-1:t.position<e.position?1:0})},setInitialActiveItem:function(){this.activeNavItem=this.navItems.filter(function(t){return t.node.classList.contains(this.settings.activeClassName)}.bind(this))[0]||null},setCurrentItem:function(){var t=window.pageYOffset;if(window.innerHeight+t>=n&&o(this.navItems[0].node))return this.toggle(this.navItems[0]),this;for(var e=0;e<this.navItems.length;e++)if(this.navItems[e].position<=t)return this.toggle(this.navItems[e]),this;this.toggle(null),!!this.settings.callback&&this.settings.callback()},toggle:function(t){this.activeNavItem!==t&&(this.activeNavItem&&this.activeNavItem.node.classList.remove(this.settings.activeClassName),this.activeNavItem=t,t&&t.node.classList.add(this.settings.activeClassName))}};return{init:t,destroy:e}});